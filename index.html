<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>å–®éŸ³è½å¯«è¨“ç·´å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2rem;
      background: #f4f4f4;
    }
    h1 {
      margin-bottom: 1rem;
    }
    button {
      font-size: 1.1rem;
      margin: 0.3rem;
      padding: 0.5rem 1rem;
    }
    .note-buttons, .stats {
      margin-top: 1.5rem;
    }
    #result {
      font-size: 1.4rem;
      margin-top: 1rem;
      color: #333;
    }
    .stats p {
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

  <h1>ğŸµ å–®éŸ³è½å¯«è¨“ç·´å™¨ï¼ˆC - Bï¼‰</h1>
  <button onclick="playRandomNote()">ğŸ§ æ’­æ”¾éŸ³ç¬¦</button>
  <button onclick="resetStats()">ğŸ”„ é‡ç½®çµ±è¨ˆ</button>

  <div class="note-buttons">
    <!-- éŸ³ç¬¦æŒ‰éˆ• -->
    <button onclick="checkAnswer('C')">C</button>
    <button onclick="checkAnswer('C#')">C#</button>
    <button onclick="checkAnswer('D')">D</button>
    <button onclick="checkAnswer('D#')">D#</button>
    <button onclick="checkAnswer('E')">E</button>
    <button onclick="checkAnswer('F')">F</button>
    <button onclick="checkAnswer('F#')">F#</button>
    <button onclick="checkAnswer('G')">G</button>
    <button onclick="checkAnswer('G#')">G#</button>
    <button onclick="checkAnswer('A')">A</button>
    <button onclick="checkAnswer('A#')">A#</button>
    <button onclick="checkAnswer('B')">B</button>
  </div>

  <p id="result"></p>

  <div class="stats">
    <p>ç¸½æ¸¬è©¦æ¬¡æ•¸: <span id="totalAttempts">0</span></p>
    <p>æ­£ç¢ºæ¬¡æ•¸: <span id="correctCount">0</span></p>
    <p>æ­£ç¢ºç‡: <span id="accuracy">0%</span></p>
  </div>

  <script>
    const notes = {
      'C': 261.63,
      'C#': 277.18,
      'D': 293.66,
      'D#': 311.13,
      'E': 329.63,
      'F': 349.23,
      'F#': 369.99,
      'G': 392.00,
      'G#': 415.30,
      'A': 440.00,
      'A#': 466.16,
      'B': 493.88
    };

    let currentNote = '';
    let totalAttempts = 0;
    let correctCount = 0;
    let playing = false;

    function playTone(freq, duration = 1) {
      if (playing) return; // é˜²æ­¢é‡è¤‡æ’­æ”¾
      playing = true;
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      gain.gain.value = 0.2; // ğŸ”‰ éŸ³é‡å¯èª¿æ•´ (0~1)

      osc.type = 'sine';
      osc.frequency.value = freq;
      osc.connect(gain);
      gain.connect(ctx.destination);

      osc.start();
      osc.stop(ctx.currentTime + duration);
      osc.onended = () => {
        playing = false; // æ’­æ”¾çµæŸå¾Œå…è¨±å†æ¬¡æ’­æ”¾
      };
    }



    function playRandomNote() {
      const keys = Object.keys(notes);
      const index = Math.floor(Math.random() * keys.length);
      currentNote = keys[index];
      playTone(notes[currentNote]);
      document.getElementById("result").textContent = "";
    }

    function checkAnswer(userGuess) {
      if (!currentNote) {
        playTone(notes[userGuess])
        document.getElementById("result").textContent = "è«‹å…ˆæ’­æ”¾ä¸€å€‹éŸ³ç¬¦ï¼";
        return;
      }

      totalAttempts++;

      if (userGuess === currentNote) {
        correctCount++;
        document.getElementById("result").textContent = "âœ… æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯ " + currentNote;
      } else {
        document.getElementById("result").textContent = 
          "âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ " + currentNote + "ï¼Œä½ é¸çš„æ˜¯ " + userGuess;

        // æ’­æ”¾çŒœéŒ¯éŸ³ï¼ˆç”¨æˆ¶çŒœçš„ï¼‰
        playTone(notes[userGuess]);

        // å»¶é²å†æ’­æ”¾æ­£ç¢ºéŸ³
        setTimeout(() => {
          playTone(notes[currentNote]);
        }, 1000);
      }

      // æ›´æ–°çµ±è¨ˆ
      updateStats();

      // æ¸…ç©ºç•¶å‰ç‹€æ…‹
      currentNote = '';
    }

    function updateStats() {
      const accuracy = totalAttempts > 0
        ? ((correctCount / totalAttempts) * 100).toFixed(1) + "%"
        : "0%";

      document.getElementById("totalAttempts").textContent = totalAttempts;
      document.getElementById("correctCount").textContent = correctCount;
      document.getElementById("accuracy").textContent = accuracy;
    }

    function resetStats() {
      totalAttempts = 0;
      correctCount = 0;
      currentNote = '';
      document.getElementById("result").textContent = "";
      updateStats();
    }
  </script>
</body>
</html>
